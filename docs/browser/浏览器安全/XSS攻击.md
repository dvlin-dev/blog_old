# XSS

XSS 攻击分三种:

1. 存储型
1. 反射型
1. 文档型

如何阻止:

1. 服务器对输入脚本进行过滤或者转码
1. CSP
1. HttpOnly

# 什么是 XSS?

XSS 全称是 Cross Site Scripting(即跨站脚本)，为了和 CSS 区分，故叫它 XSS。XSS 攻击是指浏览器中执行恶意脚本(无论是跨域还是同域)，从而拿到用户的信息并进行操作。

这些操作一般可以完成下面这些事情:

1. 窃取 Cookie。
1. 监听用户行为，比如输入账号密码后直接发送到黑客服务器。
1. 修改 DOM 伪造登录表单。
1. 在页面中生成浮窗广告。
1. <br />

通常情况，XSS 攻击的实现有三种方式——**存储型**、**反射型**和**文档型**。

# 存储型

用户把 script 发送到服务器中，服务器在数据库中保存该脚本，<br />其他用户一旦访问，就会触发

常见的场景是留言评论区提交一段脚本代码，如果前后端没有做好转义的工作，那评论内容存到了数据库，在页面渲染过程中直接执行, 相当于执行一段未知逻辑的 JS 代码，是非常恐怖的。这就是存储型的 XSS 攻击。

## 反射型

反射型 XSS 指的是恶意脚本作为**网络请求的一部分**。<br />比如：

```javascript
https://bowlingq.com/?xss=<script>alert('你被攻击了') </script>
```

这样，在服务器端会拿到 xss 参数,然后将内容返回给浏览器端，浏览器将这些内容作为 HTML 的一部分解析，发现是一个脚本，直接执行，这样就被攻击了。<br />和存储型不一样的是，服务器并不会存储这些恶意脚本。<br />常见的有邮箱链接

### **文档型**

文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后**修改里面的 html 文档**！<br />这样的劫持方式包括**WIFI 路由器劫持**或者**本地恶意软件**等。

# 防范措施

为了完成这一点，必须做到**一个信念，两个利用**。

## 服务器转码或者过滤

**一个信念**<br />千万不要相信任何用户的输入！<br />无论是在前端和服务端，都要对用户的输入进行**转码**或者**过滤**。<br />如：

```javascript
<script>alert('你完蛋了')</script>
```

转码之后变成：

```javascript
&lt;script&gt;alert(&#39;你完蛋了&#39;)&lt;/script&gt;
```

或者利用关键词过滤 将 script 标签删除。

## 利用 CSP

[CSP MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP)

CSP，即浏览器中的内容安全策略，它的核心思想就是服务器决定浏览器加载哪些资源，具体来说可以完成以下功能:

1. 限制其他域下的资源加载。
1. 禁止向其它域提交数据。
1. 提供上报机制，能帮助我们及时发现 XSS 攻击。

## 利用 HttpOnly

很多 XSS 攻击脚本都是用来窃取 Cookie, 而设置 Cookie 的 HttpOnly 属性后，JavaScript 便无法读取 Cookie 的值。这样也能很好的防范 XSS 攻击。

## 总结

XSS 攻击是指浏览器中执行恶意脚本, 然后拿到用户的信息进行操作。主要分为存储型、反射型和文档型。防范的措施包括:

- 一个信念: 不要相信用户的输入，对输入内容转码或者过滤，让其不可执行。
- 两个利用: 利用 CSP，利用 Cookie 的 HttpOnly 属性。
